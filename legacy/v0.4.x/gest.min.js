/* 
 * @name: gest.js
 * @description: gest.js is a webcam based gesture recognition library that helps developers make webpages more immersive.
 * @version: 0.4.3
 * @author: Hadi Michael (http://hadi.io)
 * @acknowledgements: gest.js is an extension of work started by William Wu (https://github.com/wvvvw)
 * @license: MIT License
 */

window.gest=function(e){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var t,r,i,n,o={},s={framerate:25,videoCompressionRate:5,debug:!1,locked:!1},a=!1,d=!1,c=function(t){if(o.direction=t.direction||null,o.up=t.up||!1,o.down=t.down||!1,o.left=t.left||!1,o.right=t.right||!1,o.error=t.error||null,(o.up||o.down||o.left||o.right)&&s.locked)return s.debug&&console.log("Locked. Gesture skipped."),!1;s.locked=!0,setTimeout(function(){s.locked=!1},gest.options.locking);try{return e.createEventObject?e.fireEvent("on"+o.eventType,o):e.dispatchEvent(o)}catch(e){return console.error(e),console.log(o),!1}};gest=function(){function t(){return e.removeEventListener("DOMContentLoaded",t,!1),window.removeEventListener("load",t,!1),e.createEventObject?(o=e.createEventObject()).eventType="gest":(o=e.createEvent("Event")).initEvent("gest",!0,!0),l()&&(a=!0),d&&a?gest.start():a}return this.options={skinFilter:!1,messages:!0,locking:0,debug:function(e){return s.debug=e,e?n.setAttribute("style","visibility: visible; position: fixed; left: 0; top: 0; width: 100%; height: 100%; opacity: 1;"):n.setAttribute("style","visibility: hidden; position: fixed; left: 0; top: 0; width: 100%; height: 100%; opacity: 1;"),s.debug}},"complete"===e.readyState?t():(e.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)),!0};var l=function(){return navigator.getUserMedia?((r=e.createElement("video")).width=300,r.setAttribute("style","display: none;"),e.body.appendChild(r),(i=e.createElement("canvas")).setAttribute("style","width: 300px; display: none;"),e.body.appendChild(i),i.getContext("2d"),(n=e.createElement("canvas")).setAttribute("style","display: none;"),e.body.appendChild(n),n.getContext("2d"),!0):(u(0),!1)};gest.prototype.start=function(){return d=!0,!(!navigator.getUserMedia||!a)&&(r&&(r.paused||r.ended||r.seeking||r.readyState<r.HAVE_FUTURE_DATA)?(navigator.getUserMedia?navigator.getUserMedia({audio:!1,video:!0},function(e){t=e,window.URL=window.URL||window.webkitURL,r.srcObject=t,r.addEventListener("canplaythrough",function(){r.play(),b("The force is strong with you. <br />Go forth and gesture!")})},function(e){e.PERMISSION_DENIED?u(10,e):e.NOT_SUPPORTED_ERROR?u(11,e):e.MANDATORY_UNSATISFIED_ERROR?u(12,e):u(13,e)}):u(0),!!navigator.getUserMedia):(u(2),!1))},gest.prototype.stop=function(){return!!navigator.getUserMedia&&(r&&(r.src=""),!!t.stop())};var u=function(e,t){switch(e){case 0:_error={code:e,message:"Your web browser does not support gest.js :( <br />Try using Google Chrome."};break;case 1:_error={code:e,message:"gest.js could not start."};break;case 2:_error={code:e,message:"gest.js has already started."};break;case 10:_error={code:e,message:"DEEEENIED! The user denied permission to use a media device required for the operation.",obj:t};break;case 11:_error={code:e,message:"A constraint specified is not supported by the web browser.",obj:t};break;case 12:_error={code:e,message:"No media tracks of the type specified in the constraints are found.",obj:t};break;case 13:_error={code:e,message:"Couldn't get user media.",obj:t};break;default:_error=null}s.debug&&console.error(_error),c({error:_error})},g=null,p=null,v=!1,b=function(t,r){if(!gest.options.messages||!t)return!1;if(v)return v=!0,!1;var i=r||2500;window.clearTimeout(g),window.clearInterval(p);var n='visibility: visible; position: fixed; left: 50%; top: 40%; min-height: 80px; margin-top: -50px; padding: 10px; background-color: #222222; border-radius: 10px; z-index: 100; font: normal 15px/1.1 "Helvetica Neue", Helvetica, Arial, sans-serif; color: #FFFFFF; font-size: 35px; text-align: center;';e.width>767||window.innerWidth>767?n+="margin-left: -250px; width: 500px":n+="margin-left: -40%; width:80%; min-width: 250px";var o=1;return messageContainer.innerHTML=t,messageContainer.setAttribute("style",n),g=window.setTimeout(function(){p=window.setInterval(function(){o-.1<=0?(window.clearInterval(p),messageContainer.setAttribute("style","visibility: hidden")):(o-=.05,messageContainer.setAttribute("style","opacity: "+o+";"+n)),v=!1},40)},i),i>=2e3&&(v=!0),!0};return new gest}(document);